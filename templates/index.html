{% extends "base.html" %}

{% block content %}
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h4 m-0">Openstaande opdrachten</h1>
    <a class="btn btn-primary btn-sm" href="{{ url_for('admin') }}">Plaats opdracht</a>
  </div>

  <!-- Filters -->
  <form method="get" class="card mb-4 shadow-sm">
    <div class="card-body">
      <div class="fw-semibold mb-2">Filter op categorie</div>
      <div class="d-flex flex-wrap gap-3">
        {% for slug, label in categories %}
          <label class="form-check">
            <input class="form-check-input" type="checkbox" name="cat" value="{{ slug }}" {% if slug in selected %}checked{% endif %}>
            <span class="form-check-label">{{ label }}</span>
          </label>
        {% endfor %}
      </div>
      <div class="mt-3">
        <button class="btn btn-sm btn-outline-primary" type="submit">Filter toepassen</button>
        <a class="btn btn-sm btn-link" href="{{ url_for('index') }}">Reset</a>
      </div>
    </div>
  </form>

  {% if jobs|length == 0 %}
    <div class="alert alert-info">Geen opdrachten gevonden met deze filters.</div>
  {% endif %}

  <!-- Vacature cards -->
  <div class="row g-4">
    {% for job in jobs %}
      <div class="col-md-6">
        <div class="card h-100 shadow-sm">
          <div class="card-body d-flex flex-column">
            <div class="d-flex justify-content-between">
              <h5 class="card-title">{{ job['title'] }}</h5>
              <small class="text-muted">{{ job['created_at'][:10] }}</small>
            </div>
            <h6 class="card-subtitle mb-2 text-muted">
              {% if job['company'] %}{{ job['company'] }}{% endif %}
              {% if job['location'] %} • {{ job['location'] }}{% endif %}
            </h6>
            <p class="mb-2"><strong>Uren:</strong> {{ job['hours'] }} • <strong>Tarief:</strong> €{{ '%.2f'|format(job['rate']) }}/uur</p>

            {% set cats = (job['categories'] or '').split(',') %}
            {% if cats and cats[0] != '' %}
              <div class="mb-2">
                {% for c in cats %}
                  <span class="badge bg-light text-dark border">{{ c|capitalize }}</span>
                {% endfor %}
              </div>
            {% endif %}

            <p class="card-text text-truncate">{{ job['description'] }}</p>
            <div class="mt-auto">
              <a href="{{ url_for('job_detail', job_id=job['id']) }}" class="btn btn-sm btn-primary">Bekijk opdracht</a>
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% endblock %}
